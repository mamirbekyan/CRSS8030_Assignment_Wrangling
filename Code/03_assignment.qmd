---
title: "Assignment 3 - Amirbekyan, Mari"
format:
  html:
    code-fold: false
    embed-resources: true
    toc: true
---
<style>
  p { color: green; }     /* Makes all paragraphs green */
  h1 { color: blue; }   /* Makes all H1 headings blue */
</style>

# Dataset Description: U.S. Bilateral Trade in Poultry Products  

This dataset contains bilateral international trade data for the United States as the reporter country, focusing on the commodity classified under "**meat and edible offal**" of poultry, traded in fresh, chilled, or frozen form.  

The dataset includes poultry products, covering common cuts and parts such as breasts, thighs, wings, livers, hearts, and gizzards. It excludes live poultry and processed poultry products.  

Trade flows are reported with all countries as partners, meaning the data capture U.S. poultry trade with every trading partner (countries) worldwide. The dataset includes:  

-   Imports: Poultry products entering the United States from foreign suppliers (e.g., frozen chicken from Brazil or Canada).  

-   Exports: Poultry products shipped from the United States to international markets (e.g., U.S. poultry exports to Mexico or Asian countries).  

The data are aggregated at an annual frequency and cover the period 2018â€“2025.  

# Data Source:  

The dataset is obtained from the UN Comtrade database, an open-access repository of official international trade statistics compiled from customs data reported by over 150 countries. Key variables include trade values (USD) and quantities (kilograms), reflecting officially reported bilateral trade flows between the United States and its trading partners.  

# General directions  

1.  For each question, you are encouraged to create a chunk below it, and fully develop the code that creates your answer.  

2.  You are encouraged to use wrangling functions from the packages `dplyr` and `tidyr`, and plotting functions from the package `ggplot2`.  

3.  You are encouraged to the the pipe operator (`%>%` or `|>`) to pipe wrangling steps together.  

4.  For each question, after showing your code and output (be it numerical or graphical), you also need to provide a written sentence of your answer. Just showing code output is not sufficient for full points.  

5.  As part of the initial wrangling, you are expected to:  

Transform the `qty` column from kg to Mg  
Select only columns that are useful to answer the questions.  

6. Check out the following cheatsheets to give you some ideas on wrangling and plotting:  

**ggplot2**: https://posit.co/wp-content/uploads/2022/10/data-visualization-1.pdf  
**dplyr**: https://rstudio.github.io/cheatsheets/data-transformation.pdf   
  


## Dataset

```{r}
library(readxl) # to read excel files
library(janitor) # to clean data
library(dplyr) # wrangling
library(tidyr) # wrangling
library(readr) # to export csv
library(tidyverse) # to wrangle the data
library(ggplot2)
```

Setting up the data; Changing the units from Kg to Mg
```{r}
getwd()
poultrydata <- read_csv("../data/03_assignment_data.csv")

view(poultrydata)

poultrydata_Mg <- mutate(poultrydata,
                         qty_in_Mg = qty*0.001,
                         qty_in_Mg = round(qty_in_Mg, 0)
                        )


```

reducing the original file to only display columns of interest
```{r}
poultrydata_refined <- dplyr::select(poultrydata_Mg,
                                     ref_year, flow_desc, partner_desc, qty_in_Mg, primary_value)

print(poultrydata_refined)

```

Making one object that's all the imports
```{r}
imports_poultrydata <- filter (poultrydata_refined,
                               flow_desc == "Import"
                               )
print(imports_poultrydata)
```

Making one object that's all the exports
```{r}
exports_poultrydata <- filter (poultrydata_refined,
                               flow_desc == "Export"
                               )
print(exports_poultrydata)
```

# Assignemnt Questions:

## Imports:

#### 1. How many distinct countries were there (based on given data), from where US was importing the poultry products from 2018-2024?
```{r}
distinct_import_countries <- summarize (imports_poultrydata, 
                                        Import_Countries = n_distinct(partner_desc)
)

print(distinct_import_countries)                                    
                          
```
**The U.S. imported poultry from 7 distinct nations over the years 2018 to 2024**


#### 2. What are the minimum, maximum trade values for imports? Mention the country, year and its respective value.
```{r}
min_max_imports <-  imports_poultrydata %>% 
                           filter (primary_value == min (primary_value, na.rm=TRUE)| 
                           primary_value == max (primary_value, na.rm=TRUE)
                           )

#personal note for future use: the | is "OR" rather than a comma, which means "and"

print(min_max_imports)

```

**The Maximum import was from Chile in 2022 with a value of 428,214,676. The Minimum Import was from Poland in 2022 with only 4,308 import value. **

#### 3. Identify the top 5 countries from which the USA imported the most (qty) in the years 2018 and 2024. List the countries and their corresponding import values.
```{r}
#note to self: the pipe %>% lets you plug in the previous object into the next argument. So, if I start with the data I want and follow with %>%, it'll use that object to to each of the commands that follows.
top5_import_countries2018 <- imports_poultrydata %>%
  filter(ref_year == 2018) %>% #in 2018 only
  slice_max(qty_in_Mg, n=5) #only the top 5

print(top5_import_countries2018)
```

**There are only 4 countries that the U.S. imported from in 2018: Chile (40,202 Mg), Canada (31,582Mg), Israel (1,693 Mg), and Germany (66 Mg).**

```{r}
top5_import_countries2024 <- imports_poultrydata %>%
  filter(ref_year == 2024) %>%
  slice_max(qty_in_Mg, n=5)

print(top5_import_countries2024)

```

**There are only 3 countries that the U.S. imported from in 2018: Chile (55,309 Mg), Canada (31,793 Mg), and Mexico (187 Mg).**


#### 4. Calculate the total import value for the USA from each country. Which country had the highest total export value **to** US, and what was that value?
```{r}
sum_import_countries <- imports_poultrydata %>%
  group_by(partner_desc) %>%
  summarize(sum_primary_values = sum(primary_value)) %>%
  arrange(desc(sum_primary_values))

print(sum_import_countries)

```

**The country with the highest exports to the U.S. across these years was Chile, with a total value of 1,532,686,723. **

#### 5. Calculate the total import value for the USA in each year from 2018 to 2025. Which year had the highest total import value, and what was that value?
```{r}

sum_import_annual <- imports_poultrydata %>%
  group_by(ref_year) %>%
  summarize(sum_primary_values_import = sum(primary_value)) %>%
  arrange(desc(sum_primary_values_import))

print(sum_import_annual)

```
**The year with the highest imports to the U.S. was 2022, with a total value of 566,412,591. **

#### 6. Plot a line graph showing the total annual import value for the USA from 2018 to 2024. Describe any noticeable trends or patterns (e.g., increases, decreases, or fluctuations) in the graph. Create a publication ready plot.
```{r}
#x = ref_year
#y = sum_primary_values_import

ggplot(data = sum_import_annual,
       mapping = aes(x=ref_year,
                     y=sum_primary_values_import)) +
  geom_line(linewidth = 1.6, color="pink")+
  theme_classic()+
  labs(
    x = "Reference Year",
    y = "Sum of Values",
    title = "Total Annual Poultry Import Value"
  )

```

**The graph produced shows an initial increase in Imports of Poultry product to the U.S. from 2018 up to a peak in 2022, after which there is a sharp decline in 2023. The total import value in 2024 shows an increase, however not reaching 2022 values. **

## Exports:

#### 7. How many distinct countries were there (based on given data), to where US was exporting the poultry products?
```{r}
distinct_export_countries <- summarize (exports_poultrydata, 
                                        Export_Countries = n_distinct(partner_desc)
)

print(distinct_export_countries) 
```
**The U.S. exported poultry to 188 distinct nations over the years 2018 to 2024**


#### 8. What are the minimum, maximum trade values for exports? Mention the country, year and its respective value.
```{r}
min_max_exports <- filter (exports_poultrydata,
                           primary_value == min (primary_value, na.rm=TRUE)| 
                           primary_value == max (primary_value, na.rm=TRUE)
                           )

print(min_max_exports)
```

**The Maximum Export was to Mexico in 2024 with a value of 1,172,550,687. The Minimum Export was to Czechia in 2018 with only 2,900 export value. **

#### 9. Identify the top 5 countries to which the USA exported the most (qty) in the years 2018 and 2024. List the countries and their corresponding export values.
```{r}
top5_export_countries2018 <- exports_poultrydata %>%
  filter(ref_year == 2018) %>%
  slice_max(qty_in_Mg, n=5)

print(top5_export_countries2018)
```
**The top 5 Export countries in 2018 were Mexico (792,813 Mg), China, Hong Kong (291,713 Mg), Angola (209,389 Mg), Other Asia, nes (202,493 Mg), and Cuba (195,235 Mg). **

```{r}
top5_export_countries2024 <- exports_poultrydata %>%
  filter(ref_year == 2024) %>%
  slice_max(qty_in_Mg, n=5)

print(top5_export_countries2024)
```
**The top 5 Export countries in 2024 were Mexico (852,904 Mg), Cuba (239,643 Mg), Other Asia, nes (210,049 Mg), Philippines (163,084 Mg), and Canada (148,189 Mg). **


#### 10. Calculate the total export value for the USA from each country. Which country had the highest total import value **from** US, and what was that value?
```{r}
sum_export_countries <- exports_poultrydata %>%
  group_by(partner_desc) %>%
  summarize(sum_primary_values = sum(primary_value))%>%
  arrange(desc(sum_primary_values)) #if you don't put this line, it will arrage alphabetically rather than from maximum to minimum.

print(sum_export_countries)
```

**The country with the highest imports from the U.S. across these years was Mexico, with a total value of 6,823,047,519. **

#### 11. Calculate the total export value for the USA in each year from 2018 to 2025. Which year had the highest total export value, and what was that value?
```{r}
sum_export_annual <- exports_poultrydata %>%
  group_by(ref_year) %>%
  summarize(sum_primary_values_export = sum(primary_value)) %>%
  arrange(desc(sum_primary_values_export))

print(sum_export_annual)
```

**The year with the highest exports from the U.S. was 2022, with a total value of 5,401,343,250. **

#### 12. Plot a line graph showing the total annual export value for the USA from 2018 to 2024. Describe any noticeable trends or patterns (e.g., increases, decreases, or fluctuations) in the graph. Create a publication ready plot.
```{r}
#x = ref_year
#y = sum_primary_values_export

ggplot(data = sum_export_annual,
       mapping = aes(x=ref_year,
                     y=sum_primary_values_export)) +
  geom_line(linewidth = 1.6, color="darkorchid")+
  theme_classic()+
  labs(
    x = "Reference Year",
    y = "Sum of Values",
    title = "Total Annual Poultry Export Value"
  )
```

**The total Annual Export value for poultry from the U.S. shows an increase in exports from 2018 to 2022, 2022 being the peak export year. However, there is a gradual decrease for the following two years. When compared to the Import graph above, this suggests that Poultry trade generally reduced following 2022. ** 

## Imports - Exports Comparision:

#### 13. Does the U.S. behave more as a net importer or net exporter for this commodity? Explore it:

-   Based on total value US imports and exports.
```{r}
 
sum_import_values <- sum(imports_poultrydata$primary_value)
print(sum_import_values)

sum_export_values <- sum(exports_poultrydata$primary_value)
print(sum_export_values)

Poultry_values <- data.frame(
  Total_Imports = sum_import_values,
  Total_Exports = sum_export_values
) %>%
  mutate ("Exports-Imports" = Total_Exports-Total_Imports)

print(Poultry_values)

```
**Considering the Total import value and export value across all years, the US is predominantly an exporter. The export value exceeds the import value by 28,614,597,294.**

-   Based on number of countries US imports and exports
```{r}
distinct_import_countries #these are both tables because I used summarize earlier to make them.
distinct_export_countries #so, I can pull their data while renaming the columns in data.frame using "pull"

trade_partners <- data.frame(
  "Import Nations" = pull(distinct_import_countries),
  "Export Nations" = pull(distinct_export_countries)
) %>%
  mutate ("Exports-Imports" = pull(distinct_export_countries)-pull(distinct_import_countries))

print(trade_partners)

```
**Based on the number of distinct countries the US traded with across all years, the US is predominantly an exporter for poultry products. There were only 7 importing nations, while the US exported to 188 nations.**


-   Based on each year's import export value.
```{r}
annual_sum_imports <- imports_poultrydata %>%
  group_by(ref_year) %>%
  summarize(sum_primary_values_import = sum(primary_value)) #This object is not arranged descending

print(annual_sum_imports)

annual_sum_exports <- exports_poultrydata %>%
  group_by(ref_year) %>%
  summarize(sum_primary_values_export = sum(primary_value)) #This object is not arranged descending

print(annual_sum_exports)


annual_import_export_value <- annual_sum_imports %>%
  full_join(annual_sum_exports, by = "ref_year") %>%
  mutate("Exports-Imports" = sum_primary_values_export - sum_primary_values_import) %>%
  arrange(ref_year)

annual_import_export_value


```
**Based on total import export value from 2018-2024, the US was predominantly an exporter, exporting around 3 to nearly 5 billion more than it was importing each year. **


#### 14. Are the main import partners also major export destinations? Explore it based on the total import export value by countries.

Top 7 total Imports by Country
```{r}
Tot_Imports_by_Country <- imports_poultrydata %>%
  group_by(partner_desc) %>%
  summarize(sum_primary_values_import = sum(primary_value)) %>%
  arrange(desc(sum_primary_values_import))

print(Tot_Imports_by_Country)

```

Top 7 Total Exports by Country
```{r}
Tot_Exports_by_Country <- exports_poultrydata %>%
  group_by(partner_desc) %>%
  summarize(sum_primary_values_export = sum(primary_value)) %>%
  slice_max(sum_primary_values_export, n=7) %>%
  arrange(desc(sum_primary_values_export))

print(Tot_Exports_by_Country)
```
Comparing
```{r}
common_countries <-intersect(
  pull(Tot_Imports_by_Country, partner_desc),
  pull(Tot_Exports_by_Country, partner_desc)
)

print(common_countries)
```

**Since there are only 7 nations the US imported from across these years, I sorted the totals by country for these 7, and then created a top 7 Total Exports analysis by country. Then I compared if there is overlap for these countries across the lists using the intersect function, pulling the data in the two columns for trade partners in each of the created tables. The only nations that existed on both lists are Canada, Mexico, and China.**

#### 15. Can you calculate if US is in trade surplus or trade deficit for each year from 2018-2024?
```{r}
annual_deficit <- annual_sum_imports %>%
  full_join(annual_sum_exports, by = "ref_year") %>%
  mutate("Imports-Exports" = sum_primary_values_import - sum_primary_values_export) %>%
  mutate(
    "Trade" = case_when(
             "Imports-Exports">0 ~ "Surplus",
             "Imports-Exports"<0 ~ "Deficit" )) %>%
  arrange(ref_year)

print(annual_deficit)
```
**For all years, the US is in a trade surplus, where it is exporting more than it is importing from other nations.**


$$\text{Trade surplus or deficit} = \text{Imports} - \text{Exports}$$

# Submitting your work  

Once you have developed all the code and answers, make sure to Render this quarto file.  

**Notes on rendering**:  

- Make sure to render your work and inspect how the final html look like.  
- If it does not look professional for whatever reason, then fix the issue, re-render it, recheck.  
- Only send me your work once your html file looks professional.  
- Some potential issues you may encounter and how to fix them:   
  - Some times your code may be creating a table output that is waaay to long and cumbersome to scroll through when rendered. If this is the case, make it more professional looking by using the `head()` function to only print the first handful of rows (instead of thousands of rows).  
  
  - **DO NOT** delete the file's heading levels (# and ##). They set up the proper heading 1 and 2 levels, and I use them to guide my grading.  
  
  - There's a total of **15 questions**. If you mess around with the heading levels and you get a different number of questions on the rendered version, fix it.  
  
  - If a given chunk is also outputting warnings or messages, inhibit this behavior by changing the chunk options `message` and `warning` to `FALSE` (I'll demo this in a moment).  
  
  - If, after rendered, 2 lines of text are connected and you wish to "break line" between them, add 2 extra spaces after the first one (I'lld demo this in a moment).    
  
After rendering, an .html file will be created on your `code` folder.  

Rename this file to `03_assignment_LASTNAME.html`.    

For ex., `03_assignment_Bastos.html`.

Submit the html file on eLC by Monday Feb 2nd 11:59 pm, **one week** from today.  

